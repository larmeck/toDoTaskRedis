<!DOCTYPE html>
<html>
<head>
    <title>Redis + PHP To-Do App</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div id="todo">
    <h2> My To-Do List</h2>
    <input type="text" id="taskInput" placeholder="Enter a task...">
    <button onclick="addTask()">Add</button>

    <ul id="taskList"></ul>
</div>

<script>
const API_URL = "../api/";

async function loadTasks() {
    const res = await fetch(API_URL + "getTasks.php");
    const tasks = await res.json();

    const list = document.getElementById("taskList");
    list.innerHTML = "";
    tasks.forEach(t => {
        const title = t.title ?? t; // supports old Redis-only shape too
        const li = document.createElement("li");
        li.innerHTML = `${title} <button onclick='deleteTask(${JSON.stringify(title)})'>Delete</button>`;
        list.appendChild(li);
    });
}

async function addTask() {
    const input = document.getElementById("taskInput");
    const task = input.value.trim();
    if (!task) return;

    await fetch(API_URL + "addTask.php", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ task })
    });
    input.value = "";
    loadTasks();
}

async function deleteTask(task) {
    await fetch(API_URL + "deleteTask.php", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ task })
    });
    loadTasks();
}

loadTasks();
</script>
</body>
</html>
